 baesu.txt

@PURPOSE: Provide a portable facility for obtaining & printing a stack trace

@AUTHOR: Bill Chapman (bchapman2)

@DESCRIPTION: The 'baesu' package provides a facility for obtaining and
 printing a stack trace at run time.

/Hierarchical Synopsis
/---------------------
 The 'baesu' package currently has 11 components having 6 levels of physical
 dependency.  The list below shows the hierarchical ordering of the components.
 The order of components within each level is not architecturally significant,
 just alphabetical.
..
  6. baesu_assertrace

  5. baesu_stacktraceprintutil

  4. baesu_stacktraceutil

  3. baesu_stacktrace

  2. baesu_objectfileformat
     baesu_stackaddressutil
     baesu_stacktraceframe

  1. baesu_dbghelpdllimpl_windows
     baesu_stacktraceresolverimpl_elf
     baesu_stacktraceresolverimpl_windows
     baesu_stacktraceresolverimpl_xcoff
..

/Component Synopsis
/------------------
: 'baesu_asserttrace':
:      Provide controllable logging handler for assertion failures.

: 'baesu_objectfileformat':
:      Provide platform-dependent object file format trait definitions.
:
: 'baesu_stackaddressutil':
:      Provide a utility for obtaining return addresses from the stack.
:
: 'baesu_stacktrace':
:      Provide a description of a function-call stack.
:
: 'baesu_stacktraceframe':
:      Provide an attribute class describing an execution stack frame.
:
: 'baesu_stacktraceprintutil':
:      Provide a single function to perform and print a stack trace.
:
: 'baesu_stacktraceutil':
:      Provide low-level utilities for obtaining & printing a stack-trace.

/Usage
/-----
 This example shows how to obtain a stack trace and print it to a stream, all
 by calling just the static function
 'baesu_StackTracePrintUtil::printStackTrace'.
 
 First, we define a recursive function 'recurseAndPrintStack' that recurses
 to the specified 'depth', then calls
 'baesu_StackTracePrintUtil::printStackTrace' to obtain a stack trace and
 print it to 'cout'.  When we call 'printStackTrace', neither of the optional
 arguments corresponding to 'maxFrames' or 'demanglingPreferredFlag' are
 supplied; 'maxFrames' defaults to at least 1024 (which is more than we
 need), and 'demanglingPreferredFlag' defaults to 'true'.

..
  static
  void recurseAndPrintStack(int *depth)
      // Recurse to the specified 'depth', then print out the stack trace to
      // 'cout'.
  {
      if (--*depth > 0) {
          recurseAndPrintStack(depth);
      }
      else {
          baesu_StackTracePrintUtil::printStackTrace(cout);
      }
  
      ++*depth;   // Prevent compiler from optimizing tail recursion as a
                  // loop.
  }
..
 Then, we call 'recurseAndPrintStack' from the main program.
..
  int main()
  {
      int depth = 5;
      recurseAndPrintStack(&depth);
      assert(5 == depth);
  }
..
 Now, invoking the main program on AIX produces the following output:
..
  (0): BloombergLP::baesu_StackTracePrintUtil::.printStackTrace(
       std::basic_ostream<char,std::char_traits<char> >&,int,bool)+0x170 at
       0x1000a2c8 source:baesu_stacktraceprintutil.cpp:52 in
       baesu_stacktraceprintutil.t.dbg_
  (1): .recurseAndPrintStack(int*)+0x58 at 0x1000a118
       source:baesu_stacktraceprintutil.t.cpp:652 in
       baesu_stacktraceprintutil.t.dbg_
  (2): .recurseAndPrintStack(int*)+0x40 at 0x1000a100
       source:baesu_stacktraceprintutil.t.cpp:650
       in baesu_stacktraceprintutil.t.dbg_
  (3): .recurseAndPrintStack(int*)+0x40 at 0x1000a100
       source:baesu_stacktraceprintutil.t.cpp:650 in
       baesu_stacktraceprintutil.t.dbg_
  (4): .recurseAndPrintStack(int*)+0x40 at 0x1000a100
       source:baesu_stacktraceprintutil.t.cpp:650 in
       baesu_stacktraceprintutil.t.dbg_
  (5): .recurseAndPrintStack(int*)+0x40 at 0x1000a100
       source:baesu_stacktraceprintutil.t.cpp:650 in
       baesu_stacktraceprintutil.t.dbg_
  (6): .main+0x2f4 at 0x10000a4c source:baesu_stacktraceprintutil.t.cpp:724
       in baesu_stacktraceprintutil.t.dbg_
  (7): .__start+0x6c at 0x1000020c source:crt0main.s in
       baesu_stacktraceprintutil.t.dbg_
..
 Finally, we observe the following about the above output to 'cout'.  Notice
 that since the actual output would write each stack trace frame all on a
 single line, and all the lines here were longer than 80 characters, it has
 been manually edited to wrap and have every line be less than 80 columns.
 Also note the program name is truncated to 32 characters in length.
